name: Scaffold tests and ShellCheck

on:
  push:
    paths:
      - 'scripts/sarp/**'
      - '.github/workflows/**'
  pull_request:
    paths:
      - 'scripts/sarp/**'

jobs:
  shellcheck-and-tests:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Install ShellCheck
        run: |
          sudo apt-get update -y
          sudo apt-get install -y shellcheck

      - name: Run ShellCheck on scripts
        run: |
          echo "Running shellcheck on scripts/sarp and scripts"
          shellcheck scripts/**/*.sh

      - name: Bash syntax check
        run: |
          find scripts -type f -name '*.sh' -print0 | xargs -0 -n1 -I{} bash -n {}

      - name: Run scaffold tests (validate_target)
        run: |
          if [[ -x scripts/sarp/tests/test_validate_target.sh ]]; then
            bash scripts/sarp/tests/test_validate_target.sh
          else
            echo "No test script found or not executable"
            exit 0
          fi
